<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="Content-Type" content="text/html" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- <meta
            http-equiv="Content-Security-Policy"
            content="default-src *" /> -->

        <!-- Icon start -->
        <link rel="icon" href="../images/icons/IconSheet.svg#browserlogo">
        <link rel="apple-touch-icon" href="../images/icons/IconSheet.svg#browserlogo">
        <link rel="shortcut icon" href="../images/icons/IconSheet.svg#browserlogo" />
        <link rel="mask-icon" href="../images/icons/IconSheet.svg#browserlogo" />
        <!-- Icon end -->

        <!-- Global site tag (gtag.js) - Google Analytics START ------------------->

        <script defer src="https://www.googletagmanager.com/gtag/js?id=G-2W1VXE5GSE"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-2W1VXE5GSE');
        </script>
        
        <!-- Global site tag (gtag.js) - Google Analytics END ---------------------->

        <!-- NO JS Behavior START -->
        <noscript>
            <style>
                nav.sidenav {display:none;}
                li.nav-item{display:none;}
            </style>
        </noscript>
         <!-- NO JS Behavior END -->

        <title>Jason Yang - Docker</title>
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
    </head>

    <body>
        <!-- Side navigation start -->
        <nav class="sidenav">
            <li class="logo">
                <a href="#" class="nav-link">
                    <span class="link-text logo-text">Jason</span>
                    <svg><use href="../images/icons/IconSheet.svg#sidebardod"></use></svg>
                </a>
            </li>
        
            
            <li class="nav-item">
                <a href="../tags/mathcs.html" class="nav-link">
                    <svg><use href="../images/icons/IconSheet.svg#lambda"></use></svg>
                    <span class="link-text">Math/CS</span>
                </a>
            </li>
                
            <li class="nav-item">
                <a href="../tags/prog.html" class="nav-link">
                    <svg><use href="../images/icons/IconSheet.svg#progcode"></use></svg>
                    <span class="link-text">Prog</span>
                </a>
            </li>


            <li class="nav-item">
                <a href="../tags/AI.html" class="nav-link">
                    <svg><use href="../images/icons/IconSheet.svg#AIbrain"></use></svg>
                    <span class="link-text">ML/AI</span>
                </a>
            </li>

            <li class="nav-item">
                <a href="../tags/tech.html" class="nav-link">
                    <svg><use href="../images/icons/IconSheet.svg#hardware"></use></svg>
                    <span class="link-text">Tech</span>
                </a>
            </li>

            <li class="nav-item">
                <a href="../tags/musings.html" class="nav-link">
                    <svg><use href="../images/icons/IconSheet.svg#thinker"></use></svg>
                    <span class="link-text">Musings</span>
                </a>
            </li>


            <li class="nav-item">
                <a href="https://github.com/userJY" class="nav-link">
                    <svg><use href="../images/icons/IconSheet.svg#github"></use></svg>
                    <span class="link-text">Github</span>
                </a>
            </li>
        </nav>
        <!-- Side navigation end -->
        <div id="header">
            <div id="logo">
                <a href="../">Jason Yang</a>
            </div>
            <div id="navigation">
                <a href="../">Home</a>
                <a href="../about.html">About</a>
                <a href="../contact.html">Contact</a>
                <a href="../archive.html">Archive</a>
            </div>
        </div>

        <div id="content">
            <h1>Docker</h1>
            

            <div class="info">
    Posted on June  2, 2022
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged 'prog'." href="../tags/prog.html">prog</a>, <a title="All pages tagged 'cloud'." href="../tags/cloud.html">cloud</a>, <a title="All pages tagged 'DevOps'." href="../tags/DevOps.html">DevOps</a>
    
</div>
<div id="TOC"><ul>
<li><a href="#basics"><span class="toc-section-number">1</span> Basics</a>
<ul>
<li><a href="#image"><span class="toc-section-number">1.1</span> image</a></li>
<li><a href="#container"><span class="toc-section-number">1.2</span> container</a>
<ul>
<li><a href="#run-detached-container-and-removing-containers"><span class="toc-section-number">1.2.1</span> Run detached container and removing containers</a></li>
<li><a href="#prune"><span class="toc-section-number">1.2.2</span> Prune</a></li>
<li><a href="#pauseunpause-container"><span class="toc-section-number">1.2.3</span> pause/unpause container</a></li>
<li><a href="#container-flags"><span class="toc-section-number">1.2.4</span> container flags</a></li>
<li><a href="#name-for-containers--t-for-naming-images"><span class="toc-section-number">1.2.5</span> –name for containers , -t for naming images</a></li>
<li><a href="#logs"><span class="toc-section-number">1.2.6</span> logs</a></li>
</ul></li>
</ul></li>
<li><a href="#terminal"><span class="toc-section-number">2</span> Terminal</a>
<ul>
<li><a href="#attach-current-terminal-to-container"><span class="toc-section-number">2.1</span> attach current terminal to container</a></li>
<li><a href="#execute-terminal-inside-container"><span class="toc-section-number">2.2</span> execute terminal inside container</a></li>
<li><a href="#dockerfile-docker-build-outputs-image"><span class="toc-section-number">2.3</span> Dockerfile docker build =&gt; outputs image</a>
<ul>
<li><a href="#workdir"><span class="toc-section-number">2.3.1</span> WORKDIR</a></li>
<li><a href="#cmd"><span class="toc-section-number">2.3.2</span> CMD</a></li>
<li><a href="#entrypoint"><span class="toc-section-number">2.3.3</span> ENTRYPOINT</a></li>
<li><a href="#docker-run-containerid-sh--c-echo-hi"><span class="toc-section-number">2.3.4</span> docker run &lt;containerID&gt; sh -c ‘echo hi’</a></li>
<li><a href="#copy-files-from-local-to-container"><span class="toc-section-number">2.3.5</span> Copy files from local to container</a></li>
<li><a href="#docker-diff---check-what-our-container-did"><span class="toc-section-number">2.3.6</span> docker diff - Check what our container did</a></li>
<li><a href="#v-volume-for-shared-access"><span class="toc-section-number">2.3.7</span> -v Volume for shared access</a></li>
</ul></li>
<li><a href="#ports-and-network"><span class="toc-section-number">2.4</span> Ports and Network</a></li>
</ul></li>
<li><a href="#memory-limit"><span class="toc-section-number">3</span> Memory limit</a></li>
<li><a href="#neat-trick"><span class="toc-section-number">4</span> Neat trick</a></li>
<li><a href="#mistakes"><span class="toc-section-number">5</span> Mistakes</a></li>
<li><a href="#docker-compose"><span class="toc-section-number">6</span> Docker-Compose</a></li>
</ul></div>
<section id="basics" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Basics</h1>
<section id="image" class="level2" data-number="1.1">
<h2 data-number="1.1"><span class="header-section-number">1.1</span> image</h2>
<table>
<thead>
<tr class="header">
<th>Command</th>
<th>Shortcut</th>
<th>Defined</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>docker image ls</td>
<td>docker images</td>
<td>ls images</td>
</tr>
<tr class="even">
<td>docker image rm &lt;image&gt;</td>
<td>docker rmi &lt;image&gt;</td>
<td>removes image</td>
</tr>
<tr class="odd">
<td>docker image pull &lt;image&gt;</td>
<td>docker pull &lt;image&gt;</td>
<td>pull image from docker registry</td>
</tr>
</tbody>
</table>
</section>
<section id="container" class="level2" data-number="1.2">
<h2 data-number="1.2"><span class="header-section-number">1.2</span> container</h2>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>Command</th>
<th>Shortcut</th>
<th>Defined</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>docker container ls -a</td>
<td>docker ps -a</td>
<td>list all containers (-a includes stopped)</td>
</tr>
<tr class="even">
<td>docker container run &lt;image&gt;</td>
<td>docker run &lt;image&gt;</td>
<td>runs container from an image</td>
</tr>
<tr class="odd">
<td>docker container rm &lt;containerID or name&gt;</td>
<td>docker rm &lt;containerID or name&gt;</td>
<td>removes container</td>
</tr>
<tr class="even">
<td>docker container stop &lt;containerID or name&gt;</td>
<td>docker stop &lt;containerID or name&gt;</td>
<td>stop container</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Docker containers don’t remove themselves when they terminate, they enter a stopped state.</p>
</blockquote>
<section id="run-detached-container-and-removing-containers" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1"><span class="header-section-number">1.2.1</span> Run detached container and removing containers</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> container run <span class="at">-d</span> <span class="at">--name</span> bleh nginx</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;d89war8wf0489fwa08498w0atr48q0g8949a439w0</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> container ls <span class="at">-a</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a> <span class="co">#&gt;CONTAINER ID   IMAGE   COMMAND                  CREATED             STATUS         PORTS     NAMES</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a> <span class="co">#&gt;d89war8wf048   nginx  &quot;nginx -g 'daemon of…&quot;   35 seconds ago      Up 34 seconds   80/tcp    bleh</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">#docker container kill d89war </span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> container stop d89war </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> container rm d89war</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">#docker container stop &quot;bleh&quot;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">#docker container rm &quot;bleh&quot;</span></span></code></pre></div>
<p>&lt;containerID&gt; = d89war8wf048<br />
<code class="sourceCode bash"><span class="ex">--name</span> bleh</code> means we can refer to “bleh” instead of “d89war8wf048”</p>
<p><code class="sourceCode bash"><span class="ex">docker</span> container kill d89war</code> is faster than <code class="sourceCode bash"><span class="ex">docker</span> container stop d89war</code></p>
</section>
<section id="prune" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2"><span class="header-section-number">1.2.2</span> Prune</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> container prune <span class="co">#removes stopped containers</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> image prune</span></code></pre></div>
</section>
<section id="pauseunpause-container" class="level3" data-number="1.2.3">
<h3 data-number="1.2.3"><span class="header-section-number">1.2.3</span> pause/unpause container</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> pause c3d288</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> unpause c3d288</span></code></pre></div>
</section>
<section id="container-flags" class="level3" data-number="1.2.4">
<h3 data-number="1.2.4"><span class="header-section-number">1.2.4</span> container flags</h3>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Command</th>
<th>Defined</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>docker run -d ubuntu</td>
<td>detach running container from current terminal</td>
</tr>
<tr class="even">
<td>docker run -it ubuntu</td>
<td>-i lets you write commands to container, -t run terminal inside container</td>
</tr>
<tr class="odd">
<td>docker run ubuntu –rm</td>
<td>–rm Removes container instead of stopped state on termination</td>
</tr>
<tr class="even">
<td>docker run –name Bleh ubuntu</td>
<td>we can refer to “Bleh” instead of &lt;containerID or name&gt;</td>
</tr>
<tr class="odd">
<td>docker logs -f Bleh</td>
<td>Outputs the log of “Bleh”</td>
</tr>
</tbody>
</table>
</section>
<section id="name-for-containers--t-for-naming-images" class="level3" data-number="1.2.5">
<h3 data-number="1.2.5"><span class="header-section-number">1.2.5</span> –name for containers , -t for naming images</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> container run <span class="at">-d</span> <span class="at">-it</span> <span class="at">--name</span> looperA ubuntu sh <span class="at">-c</span> <span class="st">'while true; do date; sleep 1; done'</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> logs <span class="at">-f</span> looperA</span></code></pre></div>
</section>
<section id="logs" class="level3" data-number="1.2.6">
<h3 data-number="1.2.6"><span class="header-section-number">1.2.6</span> logs</h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> logs <span class="at">-f</span> looperA</span></code></pre></div>
</section>
</section>
</section>
<section id="terminal" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Terminal</h1>
<section id="attach-current-terminal-to-container" class="level2" data-number="2.1">
<h2 data-number="2.1"><span class="header-section-number">2.1</span> attach current terminal to container</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> attach c3d288</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#hit Ctrl-C to terminate the container looperA</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> attach <span class="at">--no-stdin</span> c3d288</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#will not terminate container if hit Ctrl-C</span></span></code></pre></div>
<ul>
<li>If attach results in a <strong>hanging terminal with no output</strong>, it means there is no bash terminal running inside the container and you must execute one, by <strong>following instructions in next section</strong></li>
</ul>
</section>
<section id="execute-terminal-inside-container" class="level2" data-number="2.2">
<h2 data-number="2.2"><span class="header-section-number">2.2</span> execute terminal inside container</h2>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> exec <span class="at">-it</span> c3d288 bash </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&gt;root@d89war8wf048 we are now in as bash inside the container</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="bu">exit</span> <span class="co">#this won't stop the container, let's us exit terminal</span></span></code></pre></div>
</section>
<section id="dockerfile-docker-build-outputs-image" class="level2" data-number="2.3">
<h2 data-number="2.3"><span class="header-section-number">2.3</span> Dockerfile docker build =&gt; outputs image</h2>
<div class="sourceCode" id="cb9" data-filename="Dockerfile"><pre class="sourceCode Dockerfile"><code class="sourceCode dockerfile"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Start from the alpine image</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> alpine:3.13</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use /usr/src/app as our workdir. The following instructions will be executed in this location.</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="kw">WORKDIR</span> /usr/src/app</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Set the environment variable LC_ALL</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="kw">ENV</span> LC_ALL=C.UTF-8 </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy the hello.sh file from this location to /usr/src/app/ creating /usr/src/app/hello.sh.</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> hello.sh .</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Execute a command with `/bin/sh -c` prefix.</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> touch additional.txt</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co"># When running docker run the command will be ./hello.sh</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="kw">CMD</span> ./hello.sh</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co">#CMD [&quot;/somebinary&quot;]</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build . <span class="at">-t</span> bleh</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># REPOSITORY   TAG        IMAGE ID       CREATED          SIZE</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># bleh         latest     b396ac3611b3   21 seconds ago   5.61MB</span></span></code></pre></div>
<p><code class="sourceCode bash"><span class="ex">docker</span> build . <span class="at">-t</span> bleh:v2</code> add the <code class="sourceCode bash"><span class="ex">:v2</span></code> to give it a v2 TAG.</p>
<ul>
<li>Best practice(cache): Use commands that change less at the top and<br />
change more at the bottom of the Dockerfile file.</li>
</ul>
<p>Keywords List: <code class="sourceCode dockerfile"><span class="kw">RUN</span> <span class="kw">CMD</span> <span class="kw">ADD</span> <span class="kw">COPY</span> <span class="kw">ENTRYPOINT</span> <span class="kw">WORKDIR</span> <span class="kw">ENV</span></code></p>
<section id="workdir" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1"><span class="header-section-number">2.3.1</span> WORKDIR</h3>
<ul>
<li><code class="sourceCode dockerfile"><span class="kw">WORKDIR</span></code> sets the execution directory of commands:
<ul>
<li><code class="sourceCode dockerfile"><span class="kw">RUN</span> <span class="kw">CMD</span> <span class="kw">ADD</span> <span class="kw">COPY</span> <span class="kw">ENTRYPOINT</span></code></li>
<li><code class="sourceCode dockerfile"><span class="kw">CMD</span></code> is executed when we call “docker run $some_command”
<ul>
<li>All other commands are ran before during build time</li>
</ul></li>
</ul></li>
</ul>
<p><code class="sourceCode dockerfile"><span class="kw">RUN</span></code> is our internal image build terminal which runs before <code class="sourceCode dockerfile"><span class="kw">CMD</span></code>.<br />
<code class="sourceCode dockerfile"><span class="kw">CMD</span></code> is that single command we run when we start our new image as a container. Therefore only one <code class="sourceCode dockerfile"><span class="kw">CMD</span></code> will run, rest is overidden.</p>
</section>
<section id="cmd" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2"><span class="header-section-number">2.3.2</span> CMD</h3>
<p>The 2 blocks below are equal.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run blehImage:latest <span class="va">$somecommand</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> blehImage:latest</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CMD</span> $somecommand </span></code></pre></div>
</section>
<section id="entrypoint" class="level3" data-number="2.3.3">
<h3 data-number="2.3.3"><span class="header-section-number">2.3.3</span> ENTRYPOINT</h3>
<p>Entrypoint is the main binary ran when you call<br />
<code class="sourceCode bash"><span class="ex">docker</span> run <span class="op">&lt;</span>containerID or name<span class="op">&gt;</span> args</code></p>
<p>default <code class="sourceCode dockerfile"><span class="kw">ENTRYPOINT</span> [<span class="st">&quot;/bin/sh&quot;</span>]</code></p>
<p>Example</p>
<ul>
<li>Create an image called “youtubeDL”</li>
<li><code class="sourceCode dockerfile"><span class="kw">ENTRYPOINT</span> [<span class="st">&quot;/usr/local/bin/youtube-dl&quot;</span>]</code> in Dockerfile</li>
<li><code class="sourceCode bash"><span class="ex">docker</span> run youtubeDL http://imgur.com/asf</code> =&gt;<br />
Executing <code class="sourceCode bash"><span class="ex">/usr/local/bin/youtube-dl</span> http://imgur.com/asf</code> inside the container</li>
</ul>
</section>
<section id="docker-run-containerid-sh--c-echo-hi" class="level3" data-number="2.3.4">
<h3 data-number="2.3.4"><span class="header-section-number">2.3.4</span> docker run &lt;containerID&gt; sh -c ‘echo hi’</h3>
<p>Summary: Use brackets to supply arguments to binary executables</p>
<p>we use <code class="sourceCode bash"><span class="fu">sh</span> <span class="at">-c</span></code> because it allows us to run shell with $PATH and Environment vars.</p>
<p>We can have our Dockerfile use <code class="sourceCode bash"><span class="fu">sh</span> <span class="at">-c</span></code> by <strong>unbracketing</strong> the ENTRYPOINT or CMD</p>
<ol type="1">
<li>Both w/o Bracket</li>
</ol>
<ul>
<li><code class="sourceCode dockerfile"><span class="kw">ENTRYPOINT</span> /bin/ping -c 3</code></li>
<li><code class="sourceCode dockerfile"><span class="kw">CMD</span> localhost</code>
<ul>
<li><code class="sourceCode bash"><span class="ex">/bin/sh</span> <span class="at">-c</span> ‘/bin/ping <span class="at">-c</span> 3’ /bin/sh <span class="at">-c</span> localhost</code></li>
</ul></li>
</ul>
<ol start="2" type="1">
<li>Entrypoint w/ Bracket</li>
</ol>
<ul>
<li><code class="sourceCode dockerfile"><span class="kw">ENTRYPOINT</span> [“/bin/ping”,”-c”,”3”]</code></li>
<li><code class="sourceCode dockerfile"><span class="kw">CMD</span> localhost</code>
<ul>
<li><code class="sourceCode bash"><span class="ex">/bin/ping</span> <span class="at">-c</span> 3 /bin/sh <span class="at">-c</span> localhost</code></li>
</ul></li>
</ul>
<ol start="3" type="1">
<li>CMD w/ Bracket</li>
</ol>
<ul>
<li><code class="sourceCode dockerfile"><span class="kw">ENTRYPOINT</span> /bin/ping -c 3</code></li>
<li><code class="sourceCode dockerfile"><span class="kw">CMD</span> [“localhost”]</code>
<ul>
<li><code class="sourceCode bash"><span class="ex">/bin/sh</span> <span class="at">-c</span> ‘/bin/ping <span class="at">-c</span> 3’ localhost</code></li>
</ul></li>
</ul>
<ol start="4" type="1">
<li>Both w/ Bracket</li>
</ol>
<ul>
<li><code class="sourceCode dockerfile"><span class="kw">ENTRYPOINT</span> [“/bin/ping”,”-c”,”3”]</code></li>
<li><code class="sourceCode dockerfile"><span class="kw">CMD</span> [“localhost”]</code>
<ul>
<li><code class="sourceCode bash"><span class="ex">/bin/ping</span> <span class="at">-c</span> 3 localhost</code></li>
</ul></li>
</ul>
<section id="examples" class="level4" data-number="2.3.4.1">
<h4 data-number="2.3.4.1"><span class="header-section-number">2.3.4.1</span> Examples</h4>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">CMD</span> [<span class="st">&quot;/code-server&quot;</span>,<span class="st">&quot;--accept-server-license-terms&quot;</span>]</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> [<span class="st">&quot;ls&quot;</span>,<span class="st">&quot;/lib&quot;</span>]</span></code></pre></div>
</section>
</section>
<section id="copy-files-from-local-to-container" class="level3" data-number="2.3.5">
<h3 data-number="2.3.5"><span class="header-section-number">2.3.5</span> Copy files from local to container</h3>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> bleh.txt</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> cp ./bleh.txt <span class="dt">\&lt;</span>containerID or name\&gt;:/usr/src/app/</span></code></pre></div>
</section>
<section id="docker-diff---check-what-our-container-did" class="level3" data-number="2.3.6">
<h3 data-number="2.3.6"><span class="header-section-number">2.3.6</span> docker diff - Check what our container did</h3>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> diff <span class="dt">\&lt;</span>containerID or name<span class="dt">\&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># C /usr</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># C /usr/src</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># C /usr/src/app</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># A /usr/src/app/bleh.txt</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># C /root</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># A /root/.ash_history</span></span></code></pre></div>
<p>A = Added<br />
C = Changed<br />
D = Deleted</p>
<hr />
</section>
<section id="v-volume-for-shared-access" class="level3" data-number="2.3.7">
<h3 data-number="2.3.7"><span class="header-section-number">2.3.7</span> -v Volume for shared access</h3>
<p>Allow your local machine and container to access the same resource</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-v</span> <span class="st">&quot;</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">/localdir:/remotedir&quot;</span> ubuntu </span></code></pre></div>
<p><code class="sourceCode bash"><span class="ex">-v</span> <span class="op">&lt;</span>localpath<span class="op">&gt;</span>:<span class="op">&lt;</span>remotepath<span class="op">&gt;</span></code></p>
</section>
</section>
<section id="ports-and-network" class="level2" data-number="2.4">
<h2 data-number="2.4"><span class="header-section-number">2.4</span> Ports and Network</h2>
<p>Expose port: tell container to listen to a certain port(doesn’t do much but helps for documentation)
<code class="sourceCode dockerfile"><span class="kw">EXPOSE</span> &lt;port&gt;</code> in Dockerfile</p>
<p>Publish port: map local port to container port<br />
<code class="sourceCode bash"><span class="ex">-p</span> <span class="op">&lt;</span>local-port<span class="op">&gt;</span>:<span class="op">&lt;</span>remote-container-port<span class="op">&gt;</span></code></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-p</span> 3000:5000 ubuntu</span></code></pre></div>
<p>We go to http://localhost:3000 to access the site.</p>
</section>
</section>
<section id="memory-limit" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Memory limit</h1>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--memory</span><span class="op">=</span><span class="st">&quot;256m&quot;</span> nginx </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--cpus</span><span class="op">=</span><span class="st">&quot;.5&quot;</span> nginx</span></code></pre></div>
</section>
<section id="neat-trick" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Neat trick</h1>
<p>In your <code>Dockerfile</code> put this as your CMD to keep your container running so you can investigate it</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="at">CMD sh -c 'while true; do date; sleep 1; done'</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="at">CMD [&quot;sh&quot;,&quot;-c&quot;, &quot;while true; do date; sleep 1; done&quot;]</span><span class="co"> #alternatively</span></span></code></pre></div>
</section>
<section id="mistakes" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Mistakes</h1>
<p><strong>Double check</strong> your <code>Dockerfile</code> with <code>vim</code> because even using vscode on a linux-server, there will be some strange inputs</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> mv /tmp/lib /lib <span class="co">#BAD </span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co">#copied lib folder INTO a lib folder, results in /lib/lib</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> mv /tmp/lib/<span class="pp">*</span> /lib <span class="co">#BAD</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">#surprisingly doesnt work because docker run `sh -c` which is shell and does NOT have wildcards * </span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> cp <span class="at">-r</span> /tmp/lib/ /lib <span class="co">#GOOD</span></span></code></pre></div>
<p>Scenario: We want to add our library files</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#no permission</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> chmod 777 /lib <span class="co">#BAD</span></span></code></pre></div>
</section>
<section id="docker-compose" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Docker-Compose</h1>
<p>File Structure</p>
<ul>
<li>docker-compose.yml</li>
<li>example-frontend
<ul>
<li>Dockerfile</li>
</ul></li>
<li>example-backend
<ul>
<li>Dockerfile</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb22" data-filename="docker-compose.yml"><pre class="sourceCode numberSource yml numberLines"><code class="sourceCode yaml"><span id="cb22-1"><a href="#cb22-1"></a><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;3.9&quot;</span></span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="at">     </span><span class="fu">myFront</span><span class="kw">:</span></span>
<span id="cb22-4"><a href="#cb22-4"></a><span class="at">          </span><span class="fu">image</span><span class="kw">:</span><span class="at"> frontend:v1</span></span>
<span id="cb22-5"><a href="#cb22-5"></a><span class="at">          </span><span class="fu">ports</span><span class="kw">:</span><span class="at"> </span></span>
<span id="cb22-6"><a href="#cb22-6"></a><span class="at">              </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;3200:5000&quot;</span></span>
<span id="cb22-7"><a href="#cb22-7"></a><span class="at">          </span><span class="fu">build</span><span class="kw">:</span><span class="at"> ./example-frontend</span></span>
<span id="cb22-8"><a href="#cb22-8"></a><span class="at">     </span><span class="fu">myBack</span><span class="kw">:</span></span>
<span id="cb22-9"><a href="#cb22-9"></a><span class="at">          </span><span class="fu">image</span><span class="kw">:</span><span class="at"> backend:v1</span></span>
<span id="cb22-10"><a href="#cb22-10"></a><span class="at">          </span><span class="fu">ports</span><span class="kw">:</span><span class="at"> </span></span>
<span id="cb22-11"><a href="#cb22-11"></a><span class="at">              </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;3300:8080&quot;</span></span>
<span id="cb22-12"><a href="#cb22-12"></a><span class="at">          </span><span class="fu">build</span><span class="kw">:</span><span class="at"> ./example-backend</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> build </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> up</span></code></pre></div>
<p>line 6 build “Dockerfile” in current dir “.”<br />
and create image named “ads/wrga:latest” (line 5)</p>
<p>docker-compose <code class="sourceCode yaml"><span class="at">environment</span></code> vs Dockerfile <code class="sourceCode dockerfile"><span class="kw">ENV</span></code>.<br />
<code class="sourceCode dockerfile"><span class="kw">ENV</span></code> is used on build time.<br />
<code class="sourceCode yaml"><span class="at">environment</span></code> is used on runtime or <code class="sourceCode bash"><span class="ex">docker</span> run $...</code></p>
</section>

        </div>
        <div id="footer">
            <div class="flex-container" style="display:flex; justify-content: space-between;">
                <div>
                    Site proudly generated by
                    <a href="http://jaspervdj.be/hakyll">Hakyll</a>
                </div>
                <div class="pagehitscounter"> 
                    <img src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fuserjy.github.io&count_bg=%231FDBD9&title_bg=%23555555&icon=&icon_color=%23E7E7E7&title=hits&edge_flat=true" />
                </div>
                <div xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/"><a property="dct:title" rel="cc:attributionURL" href="https://userjy.github.io/">Jason's Notes</a> by <a rel="cc:attributionURL dct:creator" property="cc:attributionName" href="https://userjy.github.io/">Jason Yang</a> is licensed under <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">CC BY-NC-ND 4.0<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/nc.svg?ref=chooser-v1"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/nd.svg?ref=chooser-v1"></a></div>
  
            </div>
        </div>
        
    </body>
    <footer>
        <!-- CODE TAB START -->
        <script>
                    //Structure:
                    // Codeblock < Group/Grouplabel/subgrp < datagroupSet < allblocks

            const AllBlocksPre = document.querySelectorAll("[data-group]");
            const AllBlocks = [...AllBlocksPre]; //gets all codeblocks w/ and w/o group label
            const getUniqueSet = (TargetSet,dataAttr) => {
                //gets the set of attributes of an array of codeblocks aka TargetSet
                const temp = TargetSet.map((e) => (e.getAttribute(dataAttr))); 
                const temp2 = temp.filter((a)=>a); //remove nulls
                return [...new Set(temp2)];
            } 
            const datagroupSet = getUniqueSet(AllBlocks,"data-group") //remove nulls

            const getCodeBlocks = (datagroup) => {
                //return list of glabels CodeBlocks associated to a single group 
                return AllBlocks.filter((dataglabelBlock)=>(dataglabelBlock.getAttribute("data-group") === datagroup));
            }

            const showBlocks = (dataglabeltxt,datagroupCodeBlocks) => {
                const selectedglabelGroup = datagroupCodeBlocks.filter((SingleBlock)=>(SingleBlock.getAttribute("data-glabel") === dataglabeltxt))
                const NONselectedglabelGroup = datagroupCodeBlocks.filter((SingleBlock)=>(SingleBlock.getAttribute("data-glabel") !== dataglabeltxt))
                selectedglabelGroup.map((SingleBlock) => (SingleBlock.style.display="block"));
                (NONselectedglabelGroup || []).map((SingleBlock) => (SingleBlock.style.display="none"));
            }
            const mkBtn = (dataglabeltxt,datagroupCodeBlocks,showfunc) => {
                const newbutton = document.createElement("input");
                newbutton.type = "radio";
                // newbutton.textContent = dataglabeltxt;
                newbutton.addEventListener('click', ()=>{
                    // console.log(datagroupCodeBlocks)
                    showfunc(dataglabeltxt,datagroupCodeBlocks);
                });
                return newbutton;
            }
            const showAll = (datagroup) => {
                //make all codeblocks visible
            datagroup.map((e)=>(e.style.display="block"));
            }

            const buildCodeTab = (datagroupCodeBlocks,datagroup) => {
                const leaderCodeBlockDiv = datagroupCodeBlocks[0]; //get the leader codeblock of a group of codeblock
                const setglabelstxt = getUniqueSet(datagroupCodeBlocks,"data-glabel"); 
                setglabelstxt.map((singleglabeltxt)=>{
                    
                    const btn = mkBtn(singleglabeltxt,datagroupCodeBlocks,showBlocks);
                    btn.name = datagroup;
                    btn.id = datagroup+singleglabeltxt;
                    const radiolabelx = document.createElement("label");
                    radiolabelx.setAttribute("for",datagroup+singleglabeltxt);
                    radiolabelx.innerText = singleglabeltxt;
        
                    // leaderCodeBlockDiv.insertAdjacentElement("beforebegin",radiolabelx);
                    // radiolabelx.appendChild(btn);
                    const radioclass = document.createElement("div");
                    radioclass.className = "radioclass";
                    radioclass.appendChild(btn);
                    radioclass.appendChild(radiolabelx)
                    leaderCodeBlockDiv.insertAdjacentElement("beforebegin",radioclass);
                    // leaderCodeBlockDiv.prepend(btn);
                    
                    
                })
             
                // leaderCodeBlockDiv.append(btnlist);
                
                const btnShowAll = document.createElement("input");
                btnShowAll.type = "radio";
                btnShowAll.addEventListener('click',(e)=>(showAll(datagroupCodeBlocks)));

                btnShowAll.name = datagroup;
                btnShowAll.id = datagroup+"All";
                const radiolabel = document.createElement("label");
                radiolabel.setAttribute("for",datagroup+"All");
                radiolabel.innerText = "All";

                const radioclass = document.createElement("div");
                radioclass.className = "radioclass";
                radioclass.appendChild(btnShowAll);
                radioclass.appendChild(radiolabel)
                leaderCodeBlockDiv.insertAdjacentElement('beforebegin',radioclass);
                //make showAllbutton END
            }

            //below code is performing actual behavior, the above code are just functions
            datagroupSet.map((datagroup) => {
                
                const groupOfCodeblocks = getCodeBlocks(datagroup);
                buildCodeTab(groupOfCodeblocks,datagroup);
                const firsttab = groupOfCodeblocks[0];
                showBlocks(firsttab.getAttribute("data-glabel"),groupOfCodeblocks);
       
            })
        </script>
        <!-- CODE TAB END ---->

        <!-- MATH JAX START -------------------------------------- -->
        <script id="MathJax-script" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-chtml.min.js">
        </script>
        <!-- MATH JAX END ----------------------------------------- -->
        <!-- MERMAID START -------------------------------------- -->
        <script type="module"> 
            import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/+esm'
        </script>
        <!-- <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js" async></script> -->
        <!-- MERMAID END -------------------------------------- -->
        <!-- RAILROAD START -------------------------------------- -->
        <script type="module">
            import rr,* as rrClass from "/lib/railroad/railroad.js";
            Object.assign(window,rr)
            window.rrOptions = rrClass.Options;
            document.addEventListener('DOMContentLoaded',()=>{ReplaceDivWithSvg()},false)
            const ReplaceDivWithSvg = () =>  {
                for (const railroadelem of document.getElementsByClassName("rroad") ){
                railroadelem.innerHTML = eval(railroadelem.innerText.trim()+".toString()")
                }
            }
        </script>
        

        <link rel="stylesheet" href="../lib/railroad/railroad-diagrams.css">
        <!-- RAILROAD END ----------------------------------------- -->
    </footer>
</html>
