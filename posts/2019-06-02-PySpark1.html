<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="Content-Type" content="text/html" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- <meta
            http-equiv="Content-Security-Policy"
            content="default-src *" /> -->

        <!-- Icon start -->
        <link rel="icon" href="../images/icons/IconSheet.svg#browserlogo">
        <link rel="apple-touch-icon" href="../images/icons/IconSheet.svg#browserlogo">
        <link rel="shortcut icon" href="../images/icons/IconSheet.svg#browserlogo" />
        <link rel="mask-icon" href="../images/icons/IconSheet.svg#browserlogo" />
        <!-- Icon end -->

        <!-- Global site tag (gtag.js) - Google Analytics START ------------------->

        <script defer src="https://www.googletagmanager.com/gtag/js?id=G-2W1VXE5GSE"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-2W1VXE5GSE');
        </script>
        
        <!-- Global site tag (gtag.js) - Google Analytics END ---------------------->

        <!-- NO JS Behavior START -->
        <noscript>
            <style>
                nav.sidenav {display:none;}
                li.nav-item{display:none;}
            </style>
        </noscript>
         <!-- NO JS Behavior END -->

        <title>Jason Yang - PySpark</title>
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
    </head>

    <body>
        <!-- Side navigation start -->
        <nav class="sidenav">
            <li class="logo">
                <a href="#" class="nav-link">
                    <span class="link-text logo-text">Jason</span>
                    <svg><use href="../images/icons/IconSheet.svg#sidebardod"></use></svg>
                </a>
            </li>
        
            
            <li class="nav-item">
                <a href="../tags/mathcs.html" class="nav-link">
                    <svg><use href="../images/icons/IconSheet.svg#lambda"></use></svg>
                    <span class="link-text">Math/CS</span>
                </a>
            </li>
                
            <li class="nav-item">
                <a href="../tags/prog.html" class="nav-link">
                    <svg><use href="../images/icons/IconSheet.svg#progcode"></use></svg>
                    <span class="link-text">Prog</span>
                </a>
            </li>


            <li class="nav-item">
                <a href="../tags/AI.html" class="nav-link">
                    <svg><use href="../images/icons/IconSheet.svg#AIbrain"></use></svg>
                    <span class="link-text">ML/AI</span>
                </a>
            </li>

            <li class="nav-item">
                <a href="../tags/tech.html" class="nav-link">
                    <svg><use href="../images/icons/IconSheet.svg#hardware"></use></svg>
                    <span class="link-text">Tech</span>
                </a>
            </li>

            <li class="nav-item">
                <a href="../tags/musings.html" class="nav-link">
                    <svg><use href="../images/icons/IconSheet.svg#thinker"></use></svg>
                    <span class="link-text">Musings</span>
                </a>
            </li>


            <li class="nav-item">
                <a href="https://github.com/lambdaJasonYang" class="nav-link">
                    <svg><use href="../images/icons/IconSheet.svg#github"></use></svg>
                    <span class="link-text">Github</span>
                </a>
            </li>
        </nav>
        <!-- Side navigation end -->
        <div id="header">
            <div id="logo">
                <a href="../">Jason Yang</a>
            </div>
            <div id="navigation">
                <a href="../">Home</a>
                <a href="../about.html">About</a>
                <a href="../contact.html">Contact</a>
                <a href="../archive.html">Archive</a>
            </div>
        </div>

        <div id="content">
            <h1>PySpark</h1>
            

            <div class="info">
    Posted on June  2, 2019
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged 'python'." href="../tags/python.html">python</a>, <a title="All pages tagged 'AI'." href="../tags/AI.html">AI</a>
    
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql <span class="im">import</span> SparkSession, Row</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyspark.sql.functions <span class="im">as</span> f</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.dates <span class="im">as</span> mdates</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>spark <span class="op">=</span> SparkSession.builder<span class="op">\</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    .master(<span class="st">&quot;local[*]&quot;</span>)<span class="op">\</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    .appName(<span class="st">&quot;main&quot;</span>)<span class="op">\</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    .config(<span class="st">&quot;spark.dynamicAllocation.enabled&quot;</span>, <span class="st">&quot;true&quot;</span>)<span class="op">\</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    .config(<span class="st">&quot;spark.shuffle.service.enabled&quot;</span>, <span class="st">&quot;true&quot;</span>)<span class="op">\</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    .getOrCreate()<span class="op">\</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co">#names of tables</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>airTraffic <span class="op">=</span> <span class="st">&quot;airtraffic&quot;</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>carriers <span class="op">=</span> <span class="st">&quot;carriers&quot;</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>airports <span class="op">=</span> <span class="st">&quot;airports&quot;</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>carriersTable <span class="op">=</span> spark.read.csv(<span class="st">&quot;carriers.csv&quot;</span>, inferSchema<span class="op">=</span><span class="st">&quot;true&quot;</span>, header<span class="op">=</span><span class="st">&quot;true&quot;</span>)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>carriersTable.createOrReplaceTempView(carriers)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>airportsTable <span class="op">=</span> spark.read.csv(<span class="st">&quot;airports.csv&quot;</span>, inferSchema<span class="op">=</span><span class="st">&quot;true&quot;</span>, header<span class="op">=</span><span class="st">&quot;true&quot;</span>)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>airportsTable.createOrReplaceTempView(airports)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>sampleFile <span class="op">=</span> <span class="st">&quot;2008_sample.csv&quot;</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>testFile <span class="op">=</span> <span class="st">&quot;2008_testsample.csv&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test if arrays that contain Row are equal</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> correctRows(testArray, correctArray):</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(correctArray)):</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> testArray[i].asDict() <span class="op">==</span> correctArray[i].asDict(), <span class="st">&quot;the row was expected to be </span><span class="sc">%s</span><span class="st"> but it was </span><span class="sc">%s</span><span class="st">&quot;</span> <span class="op">%</span> (correctArray[i].asDict(), testArray[i].asDict())</span></code></pre></div>
<section id="load-data-and-bind" class="level2" data-number="0.1">
<h2 data-number="0.1"><span class="header-section-number">0.1</span> Load Data and Bind</h2>
<p>Schema for airTraffic</p>
<table>
<thead>
<tr class="header">
<th>Name</th>
<th style="text-align: left;">Type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Year</td>
<td style="text-align: left;">integer (nullable = true)</td>
</tr>
<tr class="even">
<td>Month</td>
<td style="text-align: left;">integer (nullable = true)</td>
</tr>
<tr class="odd">
<td>DayofMonth</td>
<td style="text-align: left;">integer (nullable = true)</td>
</tr>
<tr class="even">
<td>DayOfWeek</td>
<td style="text-align: left;">integer (nullable = true)</td>
</tr>
<tr class="odd">
<td>DepTime</td>
<td style="text-align: left;">integer (nullable = true)</td>
</tr>
<tr class="even">
<td>CRSDepTime</td>
<td style="text-align: left;">integer (nullable = true)</td>
</tr>
<tr class="odd">
<td>ArrTime</td>
<td style="text-align: left;">integer (nullable = true)</td>
</tr>
<tr class="even">
<td>CRSArrTime</td>
<td style="text-align: left;">integer (nullable = true)</td>
</tr>
<tr class="odd">
<td>UniqueCarrier</td>
<td style="text-align: left;">string (nullable = true)</td>
</tr>
<tr class="even">
<td>FlightNum</td>
<td style="text-align: left;">integer (nullable = true)</td>
</tr>
<tr class="odd">
<td>TailNum</td>
<td style="text-align: left;">string (nullable = true)</td>
</tr>
<tr class="even">
<td>ActualElapsedTime</td>
<td style="text-align: left;">integer (nullable = true)</td>
</tr>
<tr class="odd">
<td>CRSElapsedTime</td>
<td style="text-align: left;">integer (nullable = true)</td>
</tr>
<tr class="even">
<td>AirTime</td>
<td style="text-align: left;">integer (nullable = true)</td>
</tr>
<tr class="odd">
<td>ArrDelay</td>
<td style="text-align: left;">integer (nullable = true)</td>
</tr>
<tr class="even">
<td>DepDelay</td>
<td style="text-align: left;">integer (nullable = true)</td>
</tr>
<tr class="odd">
<td>Origin</td>
<td style="text-align: left;">string (nullable = true)</td>
</tr>
<tr class="even">
<td>Dest</td>
<td style="text-align: left;">string (nullable = true)</td>
</tr>
<tr class="odd">
<td>Distance</td>
<td style="text-align: left;">integer (nullable = true)</td>
</tr>
<tr class="even">
<td>TaxiIn</td>
<td style="text-align: left;">integer (nullable = true)</td>
</tr>
<tr class="odd">
<td>TaxiOut</td>
<td style="text-align: left;">integer (nullable = true)</td>
</tr>
<tr class="even">
<td>Cancelled</td>
<td style="text-align: left;">integer (nullable = true)</td>
</tr>
<tr class="odd">
<td>CancellationCode</td>
<td style="text-align: left;">string (nullable = true)</td>
</tr>
<tr class="even">
<td>Diverted</td>
<td style="text-align: left;">integer (nullable = true)</td>
</tr>
<tr class="odd">
<td>CarrierDelay</td>
<td style="text-align: left;">integer (nullable = true)</td>
</tr>
<tr class="even">
<td>WeatherDelay</td>
<td style="text-align: left;">integer (nullable = true)</td>
</tr>
<tr class="odd">
<td>NASDelay</td>
<td style="text-align: left;">integer (nullable = true)</td>
</tr>
<tr class="even">
<td>SecurityDelay</td>
<td style="text-align: left;">integer (nullable = true)</td>
</tr>
<tr class="odd">
<td>LateAircraftDelay</td>
<td style="text-align: left;">integer (nullable = true)</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> loadBind(path,name):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">#load the raw dataSet to Spark dataframe</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> spark.read.csv(path,nullValue<span class="op">=</span><span class="st">&quot;NA&quot;</span>,inferSchema<span class="op">=</span><span class="st">&quot;true&quot;</span>, header<span class="op">=</span><span class="st">&quot;true&quot;</span>) </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">#bind the Spark dataframe to a name, which can be referred to in SQL</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Notice gotcha, it's the Spark dataframe that binds the name</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    df.createOrReplaceTempView(name) </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>loadDataAndRegister <span class="op">=</span> <span class="kw">lambda</span> x: loadBind(x,airTraffic)</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># example print</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> loadDataAndRegister(sampleFile)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>data.show(<span class="dv">2</span>) </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;schema&quot;</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#carrierData = loadBind(sampleFile,carriers)</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">#print(carrierData.schema)</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">#spark.read.table(airports)</span></span></code></pre></div>
<pre><code>+----+-----+----------+---------+-------+----------+-------+----------+-------------+---------+-------+-----------------+--------------+-------+--------+--------+------+----+--------+------+-------+---------+----------------+--------+------------+------------+--------+-------------+-----------------+
|Year|Month|DayofMonth|DayOfWeek|DepTime|CRSDepTime|ArrTime|CRSArrTime|UniqueCarrier|FlightNum|TailNum|ActualElapsedTime|CRSElapsedTime|AirTime|ArrDelay|DepDelay|Origin|Dest|Distance|TaxiIn|TaxiOut|Cancelled|CancellationCode|Diverted|CarrierDelay|WeatherDelay|NASDelay|SecurityDelay|LateAircraftDelay|
+----+-----+----------+---------+-------+----------+-------+----------+-------------+---------+-------+-----------------+--------------+-------+--------+--------+------+----+--------+------+-------+---------+----------------+--------+------------+------------+--------+-------------+-----------------+
|2008|    2|        28|        4|   1806|      1805|   1818|      1820|           WN|     1642| N392SW|               72|            75|     55|      -2|       1|   SLC| LAS|     368|     6|     11|        1|               D|       0|        null|        null|    null|         null|             null|
|2008|    4|         6|        7|   1527|      1531|   1636|      1627|           NW|     1757|  N9337|               69|            56|     30|       9|      -4|   DTW| CMH|     155|     2|     37|        0|            null|       0|        null|        null|    null|         null|             null|
+----+-----+----------+---------+-------+----------+-------+----------+-------------+---------+-------+-----------------+--------------+-------+--------+--------+------+----+--------+------+-------+---------+----------------+--------+------------+------------+--------+-------------+-----------------+
only showing top 2 rows

schema</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">'''loadDataAndRegister tests'''</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> loadBind(testFile,airTraffic)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Table &quot;airtraffic&quot; should exists</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> spark.sql(<span class="st">&quot;SHOW TABLES Like 'airtraffic'&quot;</span>).count() <span class="op">==</span> <span class="dv">1</span>, <span class="st">&quot;there was expected to be a table called 'airtraffic'&quot;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Columns should have correct values</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>third <span class="op">=</span> df.collect()[<span class="dv">2</span>]</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>correctRow <span class="op">=</span> Row(Year<span class="op">=</span><span class="dv">2008</span>, Month<span class="op">=</span><span class="dv">5</span>, DayofMonth<span class="op">=</span><span class="dv">6</span>, DayOfWeek<span class="op">=</span><span class="dv">2</span>, DepTime<span class="op">=</span><span class="dv">611</span>,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>                             CRSDepTime<span class="op">=</span><span class="dv">615</span>, ArrTime<span class="op">=</span><span class="dv">729</span>, CRSArrTime<span class="op">=</span><span class="dv">735</span>, UniqueCarrier<span class="op">=</span><span class="st">'EV'</span>,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>                             FlightNum<span class="op">=</span><span class="dv">4794</span>, TailNum<span class="op">=</span><span class="st">'N916EV'</span>, ActualElapsedTime<span class="op">=</span><span class="dv">78</span>,</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>                             CRSElapsedTime<span class="op">=</span><span class="dv">80</span>, AirTime<span class="op">=</span><span class="dv">58</span>, ArrDelay<span class="op">=-</span><span class="dv">6</span>, DepDelay<span class="op">=-</span><span class="dv">4</span>,</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>                             Origin<span class="op">=</span><span class="st">'ROA'</span>, Dest<span class="op">=</span><span class="st">'ATL'</span>, Distance<span class="op">=</span><span class="dv">357</span>, TaxiIn<span class="op">=</span><span class="dv">9</span>, TaxiOut<span class="op">=</span><span class="dv">11</span>,</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>                             Cancelled<span class="op">=</span><span class="dv">0</span>, CancellationCode<span class="op">=</span><span class="va">None</span>, Diverted<span class="op">=</span><span class="dv">0</span>, CarrierDelay<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>                             WeatherDelay<span class="op">=</span><span class="va">None</span>, NASDelay<span class="op">=</span><span class="va">None</span>, SecurityDelay<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>                             LateAircraftDelay<span class="op">=</span><span class="va">None</span>).asDict()</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> third.asDict() <span class="op">==</span> correctRow, <span class="st">&quot;the row was expected to be </span><span class="sc">%s</span><span class="st"> but it was </span><span class="sc">%s</span><span class="st">&quot;</span> <span class="op">%</span> (correctRow, third.asDict())</span></code></pre></div>
</section>
<section id="count-flights" class="level2" data-number="0.2">
<h2 data-number="0.2"><span class="header-section-number">0.2</span> Count Flights</h2>
<blockquote>
<p>TailNum = Identitification Code of Airplane<br />
Each appearance of a TailNum in Airtraffic dataframe represents 1 flight<br />
CountFlight returns number of flight for each airplane<br />
By returning the number of occurrences of TailNum in Airtraffic DataFrame</p>
</blockquote>
<table>
<thead>
<tr class="header">
<th style="text-align: right;">TailNum</th>
<th>count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">N693BR</td>
<td>1526</td>
</tr>
<tr class="even">
<td style="text-align: right;">N646BR</td>
<td>1505</td>
</tr>
<tr class="odd">
<td style="text-align: right;">N476HA</td>
<td>1490</td>
</tr>
<tr class="even">
<td style="text-align: right;">N485HA</td>
<td>1441</td>
</tr>
<tr class="odd">
<td style="text-align: right;">N486HA</td>
<td>1439</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> CountFlight(df):</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># YOUR CODE HERE</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    CountDesc <span class="op">=</span> (df</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                 .groupby(<span class="st">&quot;TailNum&quot;</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                 .count()</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                 .sort(f.desc(<span class="st">&quot;count&quot;</span>)) </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">#groupby() aggregates dataframe to groups by TailNum</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">#count() counts elements in each group</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">#sort(f.desc(&quot;count&quot;)) sorts by the count </span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    CountDescExNull <span class="op">=</span> (CountDesc</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>                       .<span class="bu">filter</span>(CountDesc.TailNum.isNotNull())</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>                      )</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">#filter() will only include non-Null TailNum</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> CountDescExNull</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># example print</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> loadBind(testFile,airTraffic)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>CountFlight(data).show(<span class="dv">20</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">#flightCount(data)[:5]</span></span></code></pre></div>
<pre><code>+-------+-----+
|TailNum|count|
+-------+-----+
| N824AS|    2|
| N873AS|    1|
| N856AS|    1|
| N916EV|    1|
| N886AS|    1|
| N881AS|    1|
+-------+-----+</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">'''flightCount tests'''</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> loadBind(testFile,airTraffic)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>correct <span class="op">=</span> [Row(TailNum<span class="op">=</span><span class="st">'N824AS'</span>, count<span class="op">=</span><span class="dv">2</span>),</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>           Row(TailNum<span class="op">=</span><span class="st">'N856AS'</span>, count<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>           Row(TailNum<span class="op">=</span><span class="st">'N886AS'</span>, count<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>           Row(TailNum<span class="op">=</span><span class="st">'N916EV'</span>, count<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>           Row(TailNum<span class="op">=</span><span class="st">'N873AS'</span>, count<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>           Row(TailNum<span class="op">=</span><span class="st">'N881AS'</span>, count<span class="op">=</span><span class="dv">1</span>)]</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>correctRows(CountFlight(data).collect(), correct)</span></code></pre></div>
</section>
<section id="cancelled-flights" class="level2" data-number="0.3">
<h2 data-number="0.3"><span class="header-section-number">0.3</span> Cancelled Flights</h2>
<blockquote>
<p>CancellationCode = ‘D’<br />
returns dataframe showing which flights were cancelled and their destination</p>
</blockquote>
<table>
<thead>
<tr class="header">
<th style="text-align: right;">FlightNum</th>
<th>Dest</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">4285</td>
<td>DHN</td>
</tr>
<tr class="even">
<td style="text-align: right;">4790</td>
<td>ATL</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3631</td>
<td>LEX</td>
</tr>
<tr class="even">
<td style="text-align: right;">3632</td>
<td>DFW</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> SecurityCancel(df):</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    output<span class="op">=</span> spark.sql(<span class="st">&quot;&quot;&quot;SELECT FlightNum, Dest from airtraffic WHERE CancellationCode='D';&quot;&quot;&quot;</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> output</span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># example print</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> loadBind(sampleFile,airTraffic)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>SecurityCancel(data).show(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>+---------+----+
|FlightNum|Dest|
+---------+----+
|     1642| LAS|
|      585| MSP|
+---------+----+</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">'''cancelledDueToSecurity tests'''</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> loadDataAndRegister(testFile)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>correct <span class="op">=</span> [Row(FlightNum<span class="op">=</span><span class="dv">4794</span>, Dest<span class="op">=</span><span class="st">'JFK'</span>), Row(FlightNum<span class="op">=</span><span class="dv">4794</span>, Dest<span class="op">=</span><span class="st">'ATL'</span>)]</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>correctRows(SecurityCancel(data).collect(), correct)</span></code></pre></div>
</section>
<section id="weather-delay" class="level2" data-number="0.4">
<h2 data-number="0.4"><span class="header-section-number">0.4</span> Weather Delay</h2>
<p>MaxWeatherDelay :: Airtraffic_df -&gt; delay_df<br />
delay_df is a singular dataframe containing the longest weather delay<br />
Between start of January and end of March</p>
<table>
<thead>
<tr class="header">
<th style="text-align: right;">_c0</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1148</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> MaxWeatherDelay(df):</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    output <span class="op">=</span> spark.sql(<span class="st">&quot;&quot;&quot; SELECT MAX(WeatherDelay) as _c0 from airtraffic WHERE Month &gt;= 1 and Month &lt;= 3&quot;&quot;&quot;</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> output</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># example print</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> loadBind(sampleFile,airTraffic)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>MaxWeatherDelay(data).show()</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>delay <span class="op">=</span> longestWeatherDelay(data).first()[<span class="dv">0</span>]</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;longest weather delay between jan and mar is </span><span class="sc">{</span>delay<span class="sc">}</span><span class="ss">&quot;</span>   )</span></code></pre></div>
<pre><code>+---+
|_c0|
+---+
| 40|
+---+

longest weather delay between jan and mar is 40</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">'''longestWeatherDelay tests'''</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> loadDataAndRegister(testFile)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> longestWeatherDelay(data).first()[<span class="dv">0</span>]</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> test <span class="op">==</span> <span class="dv">7</span>, <span class="st">&quot;the longest weather delay was expected to be 7 but it was </span><span class="sc">%s</span><span class="st">&quot;</span> <span class="op">%</span> test</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
</section>
<section id="no-flights" class="level2" data-number="0.5">
<h2 data-number="0.5"><span class="header-section-number">0.5</span> No Flights</h2>
<blockquote>
<p>NoFlight_df is a dataframe that contains the name of airlines that did not fly.<br />
carriers_df has relation (Description,Code)<br />
airtraffic_df has Code in it’s schema for all planes that flew</p>
</blockquote>
<blockquote>
<p>Goal. Get subsets of carriers_df that did not fly</p>
</blockquote>
<blockquote>
<p>every element of airtraffic_df flew<br />
carriers_df - (carriers_df intersect airtraffic_df) = planes that did not fly</p>
</blockquote>
<div class="sourceCode" id="cb19"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> didNotFly(df):</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">#a = spark.sql(&quot;SELECT DESCRIPTION from AirTraffic INNER JOIN carriers on carriers.Code = AirTraffic.UniqueCarrier;&quot;)</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> spark.sql(<span class="st">&quot;SELECT Description FROM carriers WHERE Code NOT IN (SELECT Code from airtraffic INNER JOIN carriers on carriers.Code = airtraffic.UniqueCarrier);&quot;</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">#a = spark.sql(&quot;Select Code FROM carrierse&quot;)</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a</span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> loadBind(testFile,airTraffic)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>didNotFly(data).show(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>+--------------------+
|         Description|
+--------------------+
|  Tradewind Aviation|
|     Comlux Aviation|
|Master Top Linhas...|
| Flair Airlines Ltd.|
|           Swift Air|
+--------------------+
only showing top 5 rows</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">'''didNotFly tests'''</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> loadDataAndRegister(testFile)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> didNotFly(data).count()</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> test <span class="op">==</span> <span class="dv">1489</span>, <span class="st">&quot;the amount of airlines that didn't fly was expected to be 1489 but it was </span><span class="sc">%s</span><span class="st">&quot;</span> <span class="op">%</span> test</span></code></pre></div>
</section>
<section id="flights-vegas-to-jfk" class="level2" data-number="0.6">
<h2 data-number="0.6"><span class="header-section-number">0.6</span> Flights Vegas to JFK</h2>
<p>Return description and number of flights from Vegas to JFK<br />
Countflight_df Schema (Description,Count)<br />
carriers_df Schema (Code)</p>
<table>
<thead>
<tr class="header">
<th>Description</th>
<th>Num</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>JetBlue Airways</td>
<td>566</td>
</tr>
<tr class="even">
<td>Delta Air Lines Inc.</td>
<td>441</td>
</tr>
<tr class="odd">
<td>US Airways Inc. (…</td>
<td>344</td>
</tr>
<tr class="even">
<td>American Airlines…</td>
<td>121</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb23"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> flightsFromVegasToJFK(df):</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    fdata <span class="op">=</span> CountFlight(df)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">#loadDataAndRegister(&quot;flightCount&quot;)</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    fdata.createOrReplaceTempView(<span class="st">&quot;flightCount&quot;</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    output <span class="op">=</span> spark.sql(<span class="st">&quot;&quot;&quot;</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="st">    SELECT Description, count as Num FROM </span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="st">        flightCount </span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="st">        INNER JOIN</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="st">        (SELECT * FROM </span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="st">            carriers </span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="st">            INNER JOIN </span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="st">            (SELECT DISTINCT UniqueCarrier,TailNum FROM airtraffic WHERE Origin = 'LAS' AND Dest = 'JFK') as T1</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="st">            ON</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="st">            carriers.Code = T1.UniqueCarrier) as T2</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="st">        ON flightCount.TailNum = T2.TailNum</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="st">            ORDER BY Num DESC</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="st">    &quot;&quot;&quot;</span>)</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># YOUR CODE HERE</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> output</span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># example print</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> loadBind(testFile,airTraffic)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>flightsFromVegasToJFK(data).show(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>+--------------------+---+
|         Description|Num|
+--------------------+---+
|       Titan Airways|  1|
|Atlantic Southeas...|  1|
+--------------------+---+</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">'''flightsFromVegasToJFK tests'''</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> loadDataAndRegister(testFile)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>correct <span class="op">=</span> [Row(Description<span class="op">=</span><span class="st">'Titan Airways'</span>, Num<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>           Row(Description<span class="op">=</span><span class="st">'Atlantic Southeast Airlines'</span>, Num<span class="op">=</span><span class="dv">1</span>)]</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>correctRows(flightsFromVegasToJFK(data).collect(), correct)</span></code></pre></div>
</section>
<section id="taxi-time" class="level2" data-number="0.7">
<h2 data-number="0.7"><span class="header-section-number">0.7</span> Taxi Time</h2>
<p>TaxiTime : Returns dataframe of average time in taxi at each airport<br />
Airtraffic relevant Schema(Origin, Dest, TaxiIn, TaxiOut)<br />
Origin = Airport of origin<br />
Dest = Airport of Dest<br />
TaxiIn = Time spent in taxi at Origin<br />
TaxiOut = Time spent in taxi at Dest</p>
<table>
<thead>
<tr class="header">
<th>airport</th>
<th>taxi</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>DLG</td>
<td>4.0</td>
</tr>
<tr class="even">
<td>BRW</td>
<td>5.051010191310567</td>
</tr>
<tr class="odd">
<td>OME</td>
<td>6.034800675790983</td>
</tr>
<tr class="even">
<td>AKN</td>
<td>6.75</td>
</tr>
<tr class="odd">
<td>SCC</td>
<td>6.842553191489362</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb27"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> TaxiTime(df):</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    output <span class="op">=</span> spark.sql(<span class="st">&quot;&quot;&quot;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="st">        SELECT T1.Origin as airport,(A1+A2)/2 as taxi FROM</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="st">            (SELECT Origin,AVG(TaxiIn) AS A1 FROM AirTraffic GROUP BY Origin) AS T1</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="st">            INNER JOIN</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="st">            (SELECT Dest,AVG(TaxiOut) AS A2 FROM AirTraffic GROUP BY Dest) AS T2</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="st">            ON</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="st">                T1.Origin = T2.Dest</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="st">            ORDER BY</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="st">                taxi ASC</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="st">    &quot;&quot;&quot;</span>)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> output</span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> loadBind(testFile,airTraffic)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>TaxiTime(data).show(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>+-------+-----+
|airport| taxi|
+-------+-----+
|    LAS| 11.0|
|    JFK|13.25|
+-------+-----+</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">'''timeSpentTaxiing tests'''</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> loadDataAndRegister(testFile)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>correct <span class="op">=</span> [Row(airport<span class="op">=</span><span class="st">'LAS'</span>, taxi<span class="op">=</span><span class="fl">11.0</span>), Row(airport<span class="op">=</span><span class="st">'JFK'</span>, taxi<span class="op">=</span><span class="fl">13.25</span>)]</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>correctRows(TaxiTime(data).collect(), correct)</span></code></pre></div>
</section>
<section id="median-distance" class="level2" data-number="0.8">
<h2 data-number="0.8"><span class="header-section-number">0.8</span> Median Distance</h2>
<p><code>distanceMedian</code> returns a DataFrame containing the median travel distance.</p>
<table>
<thead>
<tr class="header">
<th>_ c0</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>583.0</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb31"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> distanceMedian(df):</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> spark.sql(<span class="st">&quot;&quot;&quot;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="st">        SELECT percentile(T1,0.5)as `_ c0` FROM</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="st">            (SELECT Distance FROM AirTraffic) AS Tab(T1)</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="st">    &quot;&quot;&quot;</span>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># YOUR CODE HERE</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a</span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> loadBind(testFile,airTraffic)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>distanceMedian(data).show()</span></code></pre></div>
<pre><code>+-----+
| _ c0|
+-----+
|357.0|
+-----+</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">'''distanceMedian tests'''</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> loadDataAndRegister(testFile)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> distanceMedian(data).first()[<span class="dv">0</span>]</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> test <span class="op">==</span> <span class="fl">357.0</span>, <span class="st">&quot;the distance median was expected to be 357.0 but it was </span><span class="sc">%s</span><span class="st">&quot;</span> <span class="op">%</span> test</span></code></pre></div>
</section>
<section id="th-percentile" class="level2" data-number="0.9">
<h2 data-number="0.9"><span class="header-section-number">0.9</span> 95th Percentile</h2>
<p>DataFrame containing the 95th percentile of carrier delay.</p>
<p>Example output:</p>
<table>
<thead>
<tr class="header">
<th>_ c0</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>77.0</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb35"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> score95(df):</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> spark.sql(<span class="st">&quot;&quot;&quot;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="st">        SELECT percentile(T1,0.95)as `_ c0` FROM</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="st">            (SELECT CarrierDelay FROM AirTraffic) AS Tab(T1)</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="st">    &quot;&quot;&quot;</span>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># YOUR CODE HERE</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a</span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> loadBind(testFile,airTraffic)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>score95(data).show()</span></code></pre></div>
<pre><code>+----+
|_ c0|
+----+
|17.0|
+----+</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">'''score95 tests'''</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> loadDataAndRegister(testFile)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> score95(data).first()[<span class="dv">0</span>]</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> test <span class="op">==</span> <span class="fl">17.0</span>, <span class="st">&quot;the score95 was expected to be 17.0 but it was </span><span class="sc">%s</span><span class="st">&quot;</span> <span class="op">%</span> test</span></code></pre></div>
</section>
<section id="cancelled-flights-1" class="level2" data-number="0.10">
<h2 data-number="0.10"><span class="header-section-number">0.10</span> Cancelled Flights</h2>
<p><code>cancelledFlights</code> finds airports where flights were cancelled.</p>
<p>return: DataFrame containing columns “airport”, “city” and “percentage”.<br />
airports relevant schema (airport,city)<br />
percentage = (# cancelled flight/total flight)</p>
<p>Example output:</p>
<table>
<thead>
<tr class="header">
<th>airport</th>
<th>city</th>
<th>percentage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Pellston Regional…</td>
<td>Pellston</td>
<td>0.3157894736842105</td>
</tr>
<tr class="even">
<td>Waterloo Municipal</td>
<td>Waterloo</td>
<td>0.25</td>
</tr>
<tr class="odd">
<td>Telluride Regional</td>
<td>Telluride</td>
<td>0.21084337349397592</td>
</tr>
<tr class="even">
<td>Houghton County M…</td>
<td>Hancock</td>
<td>0.19834710743801653</td>
</tr>
<tr class="odd">
<td>Rhinelander-Oneid…</td>
<td>Rhinelander</td>
<td>0.15625</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb39"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cancelledFlights(df):</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> spark.sql(<span class="st">&quot;&quot;&quot;</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="st">        SELECT airports.airport, airports.city, T1.percentage </span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="st">        FROM</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="st">            (SELECT Origin,SUM(Cancelled)/COUNT(Origin) as percentage FROM AirTraffic </span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="st">            GROUP BY Origin) AS T1</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="st">        INNER JOIN</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="st">            airports</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="st">        ON</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="st">            T1.Origin = airports.iata</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="st">        ORDER BY</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="st">            T1.percentage DESC,</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="st">            airports.airport DESC</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="st">    &quot;&quot;&quot;</span>)</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># YOUR CODE HERE</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a</span></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> loadBind(testFile,airTraffic)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>cancelledFlights(data).show(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>+--------------------+---------+----------+
|             airport|     city|percentage|
+--------------------+---------+----------+
|McCarran Internat...|Las Vegas|       0.5|
|Roanoke Regional/...|  Roanoke|      0.25|
| John F Kennedy Intl| New York|       0.0|
+--------------------+---------+----------+</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">'''cancelledFlights tests'''</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> loadDataAndRegister(testFile)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>correct <span class="op">=</span> [Row(airport<span class="op">=</span><span class="st">'McCarran International'</span>, city<span class="op">=</span><span class="st">'Las Vegas'</span>, percentage<span class="op">=</span><span class="fl">0.5</span>),</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>           Row(airport<span class="op">=</span><span class="st">'Roanoke Regional/ Woodrum '</span>, city<span class="op">=</span><span class="st">'Roanoke'</span>, percentage<span class="op">=</span><span class="fl">0.25</span>)]</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>correctRows(cancelledFlights(data).collect(), correct)</span></code></pre></div>
</section>
<section id="least-squares" class="level2" data-number="0.11">
<h2 data-number="0.11"><span class="header-section-number">0.11</span> Least Squares</h2>
<p><code>leastSquares</code> calculates the linear least squares approximation for relationship between DepDelay and WeatherDelay.<br />
y = Bx + c where B is the slope<br />
WeatherDelay = B*(DepDelay) + c</p>
<p>returns (y-intercept,B)</p>
<p>filter out DepDelay &lt; 0. If multiple WeatherDelay then average them.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> leastSquares(df):</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>        a <span class="op">=</span> spark.sql(<span class="st">&quot;&quot;&quot;</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="st">            SELECT DD, WD, DD*WD as Prod, DD*DD as Sqx  </span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="st">            FROM</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="st">            (SELECT DepDelay as DD,AVG(WeatherDelay) as WD FROM AirTraffic</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="st">            WHERE DepDelay &gt; 0</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="st">            GROUP BY DepDelay) AS T1</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span>)</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># YOUR CODE HERE</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>        xsum <span class="op">=</span> a.groupBy().<span class="bu">sum</span>(<span class="st">'DD'</span>).collect()[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>        ysum <span class="op">=</span> a.groupBy().<span class="bu">sum</span>(<span class="st">'WD'</span>).collect()[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>        psum <span class="op">=</span> a.groupBy().<span class="bu">sum</span>(<span class="st">'Prod'</span>).collect()[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>        sqxsum <span class="op">=</span> a.groupBy().<span class="bu">sum</span>(<span class="st">'Sqx'</span>).collect()[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print(xsum)</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>        N <span class="op">=</span> a.count()</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>        varM <span class="op">=</span> ((N <span class="op">*</span> psum)<span class="op">-</span>(xsum<span class="op">*</span>ysum))<span class="op">/</span>((N <span class="op">*</span> sqxsum)<span class="op">-</span>(xsum<span class="op">**</span><span class="dv">2</span>))</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>        varB <span class="op">=</span> ((ysum<span class="op">*</span>sqxsum)<span class="op">-</span>(xsum<span class="op">*</span>psum))<span class="op">/</span>((N<span class="op">*</span>sqxsum)<span class="op">-</span>(xsum<span class="op">**</span><span class="dv">2</span>)) </span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> varB,varM</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> error:</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="fl">0.0</span>,<span class="fl">0.0</span></span></code></pre></div>
<div class="sourceCode" id="cb44"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> loadBind(testFile,airTraffic)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>leastSquares(data)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co">#leastSquares(data)[0].show(4)</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co">#print(leastSquares(data)[1])</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co">#print(leastSquares(data)[2])</span></span></code></pre></div>
<pre><code>(952.0, -56.0)</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">'''leastSquaresTests'''</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> loadDataAndRegister(testFile)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> leastSquares(data)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> test <span class="op">==</span> (<span class="fl">952.0</span>, <span class="op">-</span><span class="fl">56.0</span>), <span class="st">&quot;the answer was expected to be (952.0, -56.0) but it was </span><span class="sc">%s</span><span class="st">&quot;</span> <span class="op">%</span> test</span></code></pre></div>
<div class="sourceCode" id="cb47"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>spark.stop()</span></code></pre></div>
</section>

        </div>
        <div id="footer">
            <div class="flex-container" style="display:flex; justify-content: space-between;">
                <div>
                    Site proudly generated by
                    <a href="http://jaspervdj.be/hakyll">Hakyll</a>
                </div>
                <div class="pagehitscounter"> 
                    <img src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fuserjy.github.io&count_bg=%231FDBD9&title_bg=%23555555&icon=&icon_color=%23E7E7E7&title=hits&edge_flat=true" />
                </div>
                <div xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/"><a property="dct:title" rel="cc:attributionURL" href="https://lambdaJasonYang.github.io/">Jason's Notes</a> by <a rel="cc:attributionURL dct:creator" property="cc:attributionName" href="https://lambdaJasonYang.github.io/">Jason Yang</a> is licensed under <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">CC BY-NC-ND 4.0<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/nc.svg?ref=chooser-v1"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/nd.svg?ref=chooser-v1"></a></div>
  
            </div>
        </div>
        
    </body>
    <footer>
        <!-- CODE TAB START -->
        <script>
                    //Structure:
                    // Codeblock < Group/Grouplabel/subgrp < datagroupSet < allblocks

            const AllBlocksPre = document.querySelectorAll("[data-group]");
            const AllBlocks = [...AllBlocksPre]; //gets all codeblocks w/ and w/o group label
            const getUniqueSet = (TargetSet,dataAttr) => {
                //gets the set of attributes of an array of codeblocks aka TargetSet
                const temp = TargetSet.map((e) => (e.getAttribute(dataAttr))); 
                const temp2 = temp.filter((a)=>a); //remove nulls
                return [...new Set(temp2)];
            } 
            const datagroupSet = getUniqueSet(AllBlocks,"data-group") //remove nulls

            const getCodeBlocks = (datagroup) => {
                //return list of glabels CodeBlocks associated to a single group 
                return AllBlocks.filter((dataglabelBlock)=>(dataglabelBlock.getAttribute("data-group") === datagroup));
            }

            const showBlocks = (dataglabeltxt,datagroupCodeBlocks) => {
                const selectedglabelGroup = datagroupCodeBlocks.filter((SingleBlock)=>(SingleBlock.getAttribute("data-glabel") === dataglabeltxt))
                const NONselectedglabelGroup = datagroupCodeBlocks.filter((SingleBlock)=>(SingleBlock.getAttribute("data-glabel") !== dataglabeltxt))
                selectedglabelGroup.map((SingleBlock) => (SingleBlock.style.display="block"));
                (NONselectedglabelGroup || []).map((SingleBlock) => (SingleBlock.style.display="none"));
            }
            const mkBtn = (dataglabeltxt,datagroupCodeBlocks,showfunc) => {
                const newbutton = document.createElement("input");
                newbutton.type = "radio";
                // newbutton.textContent = dataglabeltxt;
                newbutton.addEventListener('click', ()=>{
                    // console.log(datagroupCodeBlocks)
                    showfunc(dataglabeltxt,datagroupCodeBlocks);
                });
                return newbutton;
            }
            const showAll = (datagroup) => {
                //make all codeblocks visible
            datagroup.map((e)=>(e.style.display="block"));
            }

            const buildCodeTab = (datagroupCodeBlocks,datagroup) => {
                const leaderCodeBlockDiv = datagroupCodeBlocks[0]; //get the leader codeblock of a group of codeblock
                const setglabelstxt = getUniqueSet(datagroupCodeBlocks,"data-glabel"); 
                setglabelstxt.map((singleglabeltxt)=>{
                    
                    const btn = mkBtn(singleglabeltxt,datagroupCodeBlocks,showBlocks);
                    btn.name = datagroup;
                    btn.id = datagroup+singleglabeltxt;
                    const radiolabelx = document.createElement("label");
                    radiolabelx.setAttribute("for",datagroup+singleglabeltxt);
                    radiolabelx.innerText = singleglabeltxt;
        
                    // leaderCodeBlockDiv.insertAdjacentElement("beforebegin",radiolabelx);
                    // radiolabelx.appendChild(btn);
                    const radioclass = document.createElement("div");
                    radioclass.className = "radioclass";
                    radioclass.appendChild(btn);
                    radioclass.appendChild(radiolabelx)
                    leaderCodeBlockDiv.insertAdjacentElement("beforebegin",radioclass);
                    // leaderCodeBlockDiv.prepend(btn);
                    
                    
                })
             
                // leaderCodeBlockDiv.append(btnlist);
                
                const btnShowAll = document.createElement("input");
                btnShowAll.type = "radio";
                btnShowAll.addEventListener('click',(e)=>(showAll(datagroupCodeBlocks)));

                btnShowAll.name = datagroup;
                btnShowAll.id = datagroup+"All";
                const radiolabel = document.createElement("label");
                radiolabel.setAttribute("for",datagroup+"All");
                radiolabel.innerText = "All";

                const radioclass = document.createElement("div");
                radioclass.className = "radioclass";
                radioclass.appendChild(btnShowAll);
                radioclass.appendChild(radiolabel)
                leaderCodeBlockDiv.insertAdjacentElement('beforebegin',radioclass);
                //make showAllbutton END
            }

            //below code is performing actual behavior, the above code are just functions
            datagroupSet.map((datagroup) => {
                
                const groupOfCodeblocks = getCodeBlocks(datagroup);
                buildCodeTab(groupOfCodeblocks,datagroup);
                const firsttab = groupOfCodeblocks[0];
                showBlocks(firsttab.getAttribute("data-glabel"),groupOfCodeblocks);
       
            })
        </script>
        <!-- CODE TAB END ---->

        <!-- MATH JAX START -------------------------------------- -->
        <script id="MathJax-script" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-chtml.min.js">
        </script>
        <!-- MATH JAX END ----------------------------------------- -->
        <!-- MERMAID START -------------------------------------- -->
        <script type="module"> 
            import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/+esm'
        </script>
        <!-- <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js" async></script> -->
        <!-- MERMAID END -------------------------------------- -->
        <!-- RAILROAD START -------------------------------------- -->
        <script type="module">
            import rr,* as rrClass from "/lib/railroad/railroad.js";
            Object.assign(window,rr)
            window.rrOptions = rrClass.Options;
            document.addEventListener('DOMContentLoaded',()=>{ReplaceDivWithSvg()},false)
            const ReplaceDivWithSvg = () =>  {
                for (const railroadelem of document.getElementsByClassName("rroad") ){
                railroadelem.innerHTML = eval(railroadelem.innerText.trim()+".toString()")
                }
            }
        </script>
        

        <link rel="stylesheet" href="../lib/railroad/railroad-diagrams.css">
        <!-- RAILROAD END ----------------------------------------- -->
    </footer>
</html>
