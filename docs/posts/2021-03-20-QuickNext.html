<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="Content-Type" content="text/html" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- Icon start -->
        <link rel="icon" href="../images/icons/IconSheet.svg#browserlogo">
        <link rel="apple-touch-icon" href="../images/icons/IconSheet.svg#browserlogo">
        <link rel="shortcut icon" href="../images/icons/IconSheet.svg#browserlogo" />
        <link rel="mask-icon" href="../images/icons/IconSheet.svg#browserlogo" />
        <!-- Icon end -->
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script defer src="https://www.googletagmanager.com/gtag/js?id=G-2W1VXE5GSE"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-2W1VXE5GSE');
        </script>
        <!-- Google Analytics TAG END  ---------------------->
        <!-- NO JS Behavior START -->
        <noscript>
            <style>
                nav.sidenav {display:none;}
                li.nav-item{display:none;}
            </style>
        </noscript>
         <!-- NO JS Behavior END -->

        <title>Jason Yang - Quick Nextjs</title>
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
    </head>

    <body>
        <!-- Side navigation start -->
        <nav class="sidenav">
            <li class="logo">
                <a href="#" class="nav-link">
                    <span class="link-text logo-text">Jason</span>
                    <svg><use href="../images/icons/IconSheet.svg#sidebardod"></use></svg>
                </a>
            </li>
        
            
            <li class="nav-item">
                <a href="../tags/mathcs.html" class="nav-link">
                    <svg><use href="../images/icons/IconSheet.svg#lambda"></use></svg>
                    <span class="link-text">Math/CS</span>
                </a>
            </li>
                
            <li class="nav-item">
                <a href="../tags/prog.html" class="nav-link">
                    <svg><use href="../images/icons/IconSheet.svg#progcode"></use></svg>
                    <span class="link-text">Prog</span>
                </a>
            </li>


            <li class="nav-item">
                <a href="../tags/AI.html" class="nav-link">
                    <svg><use href="../images/icons/IconSheet.svg#AIbrain"></use></svg>
                    <span class="link-text">ML/AI</span>
                </a>
            </li>

            <li class="nav-item">
                <a href="../tags/tech.html" class="nav-link">
                    <svg><use href="../images/icons/IconSheet.svg#hardware"></use></svg>
                    <span class="link-text">Tech</span>
                </a>
            </li>

            <li class="nav-item">
                <a href="../tags/musings.html" class="nav-link">
                    <svg><use href="../images/icons/IconSheet.svg#thinker"></use></svg>
                    <span class="link-text">Musings</span>
                </a>
            </li>


            <li class="nav-item">
                <a href="#" class="nav-link">
                    <svg><use href="../images/icons/IconSheet.svg#react"></use></svg>
                    <span class="link-text">React</span>
                </a>
            </li>
        </nav>
        <!-- Side navigation end -->
        <div id="header">
            <div id="logo">
                <a href="../">Jason Yang</a>
            </div>
            <div id="navigation">
                <a href="../">Home</a>
                <a href="../about.html">About</a>
                <a href="../contact.html">Contact</a>
                <a href="../archive.html">Archive</a>
            </div>
        </div>

        <div id="content">
            <h1>Quick Nextjs</h1>
            

            <div class="info">
    Posted on March 20, 2021
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged 'prog'." href="../tags/prog.html">prog</a>, <a title="All pages tagged 'QuickCode'." href="../tags/QuickCode.html">QuickCode</a>, <a title="All pages tagged 'cloud'." href="../tags/cloud.html">cloud</a>, <a title="All pages tagged 'frontend'." href="../tags/frontend.html">frontend</a>
    
</div>
<div id="TOC"><ul>
<li><a href="#document"><span class="toc-section-number">1</span> _document</a></li>
<li><a href="#app"><span class="toc-section-number">2</span> _app</a></li>
<li><a href="#file-structure-determines-routing"><span class="toc-section-number">3</span> File structure determines routing</a></li>
<li><a href="#how-do-you-select-ssg-pwa-ssr"><span class="toc-section-number">4</span> How do you select SSG, PWA, SSR</a></li>
<li><a href="#capturing-the-carid-and-modelid-as-variables"><span class="toc-section-number">5</span> Capturing the [carID] and [modelID] as variables</a></li>
<li><a href="#serverside-render"><span class="toc-section-number">6</span> ServerSide Render</a>
<ul>
<li><a href="#types-of-ssg"><span class="toc-section-number">6.1</span> 2 types of SSG</a></li>
<li><a href="#why-ssg-can-be-bad"><span class="toc-section-number">6.2</span> Why SSG can be bad?</a></li>
<li><a href="#solution-to-stale-ssg---isr"><span class="toc-section-number">6.3</span> Solution to Stale SSG - ISR</a></li>
</ul></li>
<li><a href="#self-is-not-defined"><span class="toc-section-number">7</span> Self is Not Defined</a></li>
<li><a href="#exporting-as-static-site"><span class="toc-section-number">8</span> Exporting as static site</a></li>
</ul></div>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource bash numberLines"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1"></a><span class="ex">npx</span> create-next-app@latest <span class="at">--ts</span></span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="ex">npm</span> install prettier <span class="at">--save-dev</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="ex">npm</span> install eslint-config-prettier <span class="at">--save-dev</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="ex">npm</span> install @emotion/babel-plugin <span class="at">--save-dev</span></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="ex">npm</span> install @emotion/eslint-plugin <span class="at">--save-dev</span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="ex">npm</span> install @typescript-eslint/parser <span class="at">--save-dev</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="ex">npm</span> install @typescript-eslint/eslint-plugin <span class="at">--save-dev</span></span>
<span id="cb1-9"><a href="#cb1-9"></a></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="co">#Dependencies for MUI</span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="ex">npm</span> install @emotion/react</span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="ex">npm</span> install @emotion/styled</span>
<span id="cb1-13"><a href="#cb1-13"></a></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="co">#MUI</span></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="ex">npm</span> install @mui/material</span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="ex">npm</span> install @mui/icons-material</span>
<span id="cb1-17"><a href="#cb1-17"></a></span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="co">#SSR MUI+emotion components</span></span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="ex">npm</span> install @emotion/server</span>
<span id="cb1-20"><a href="#cb1-20"></a></span>
<span id="cb1-21"><a href="#cb1-21"></a><span class="co">#auth</span></span>
<span id="cb1-22"><a href="#cb1-22"></a><span class="ex">npm</span> install <span class="at">--save</span> next-auth</span></code></pre></div>
<div class="sourceCode" id="cb2" data-filename=".eslintrc.json"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;env&quot;</span><span class="fu">:{</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;browser&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;es2021&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;node&quot;</span><span class="fu">:</span><span class="kw">true</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;parser&quot;</span><span class="fu">:</span><span class="st">&quot;@typescript-eslint/parser&quot;</span><span class="fu">,</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;parserOptions&quot;</span><span class="fu">:{</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;emcaVersion&quot;</span><span class="fu">:</span><span class="dv">2020</span><span class="fu">,</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;sourceType&quot;</span><span class="fu">:</span><span class="st">&quot;module&quot;</span><span class="fu">,</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;emcaFeatures&quot;</span><span class="fu">:{</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;jsx&quot;</span><span class="fu">:</span><span class="kw">true</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;project&quot;</span><span class="fu">:</span><span class="st">&quot;./tsconfig.json&quot;</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;extends&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;next/core-web-vitals&quot;</span><span class="ot">,</span><span class="st">&quot;plugin:@typescript-eslint/recommended&quot;</span><span class="ot">,</span><span class="st">&quot;prettier&quot;</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;plugins&quot;</span> <span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;@emotion&quot;</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;rules&quot;</span> <span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;@emotion/jsx-import&quot;</span> <span class="fu">:</span> <span class="st">&quot;error&quot;</span><span class="fu">,</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;@emotion/no-vanilla&quot;</span> <span class="fu">:</span> <span class="st">&quot;error&quot;</span><span class="fu">,</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;@emotion/import-from-emotion&quot;</span> <span class="fu">:</span> <span class="st">&quot;error&quot;</span><span class="fu">,</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;@emotion/styled-import&quot;</span><span class="fu">:</span> <span class="st">&quot;error&quot;</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;settings&quot;</span><span class="fu">:{</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;react&quot;</span><span class="fu">:{</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;version&quot;</span><span class="fu">:</span><span class="st">&quot;detect&quot;</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<div class="sourceCode" id="cb3" data-filename=".babelrc"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;presets&quot;</span> <span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;next/babel&quot;</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;plugins&quot;</span> <span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;@emotion&quot;</span><span class="ot">]</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<div class="sourceCode" id="cb4" data-filename="/lib/emotionCache.tsx"><pre class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> createCache from <span class="st">'@emotion/cache'</span><span class="op">;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>const createEmotionCache <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  return <span class="fu">createCache</span>({ key<span class="op">:</span> <span class="st">'css'</span> })<span class="op">;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>export default createEmotionCache<span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb5" data-filename="/src/components/StyledButton.tsx"><pre class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> styled from <span class="st">'@emotion/styled'</span><span class="op">;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>interface IStyleProps{</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  backColor<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>const MyButton <span class="op">=</span> styled<span class="op">.</span><span class="at">button</span><span class="op">&lt;</span>IStyleProps<span class="op">&gt;</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 100px;</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: hotpink;</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="vs">  background-color: </span><span class="sc">${</span>(props) <span class="kw">=&gt;</span> props<span class="op">.</span><span class="at">backColor</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="vs">  &amp;:hover {</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="vs">    color: purple;</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="vs">   }</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span><span class="op">;</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>const StyledButton <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  return <span class="op">&lt;</span>MyButton backColor<span class="op">=</span><span class="st">&quot;green&quot;</span><span class="op">&gt;</span>hello<span class="op">&lt;/</span>MyButton<span class="op">&gt;</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>export default StyledButton<span class="op">;</span></span></code></pre></div>
<section id="document" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> _document</h1>
<p>taken from <a href="https://github.com/mui-org/material-ui/blob/master/examples/nextjs/pages/_document.js">Official Nextjs example</a></p>
</section>
<section id="app" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> _app</h1>
<p>taken from <a href="https://github.com/mui-org/material-ui/blob/master/examples/nextjs/pages/_app.js">Official Nextjs example</a></p>
</section>
<section id="file-structure-determines-routing" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> File structure determines routing</h1>
<p>Page filename in nextjs like “landingpage.js” must be lowercase letters<br />
React Component filename in nextjs must be Uppercase like “MyCustomButton”.</p>
<figure><img src="http://www.plantuml.com/plantuml/svg/~h40737461727473616c740a0a7b0a202020207b540a20202020202b202f0a20202020202b2b207372630a20202020202b2b2b20636f6d6d6f6e0a20202020202b2b2b2b20636f6d706f6e656e74730a20202020202b2b2b2b2b204578427574746f6e0a20202020202b2b2b2b2b2b204578427574746f6e2e7473780a20202020202b2b2b2b2b2b204578427574746f6e2e746573742e74730a20202020202b2b2b2b20686f6f6b730a20202020202b2b2b2b207574696c730a20202020202b2b2b206d6f64756c65730a20202020202b2b2b2070616765730a20202020202b2b2b2b206170690a20202020202b2b2b2b205b63617249445d0a20202020202b2b2b2b2b20696e6465782e7473780a20202020202b2b2b2b2b205b6d6f64656c49445d0a20202020202b2b2b2b2b2b20696e6465782e7473780a20202020202b2b2b2b205f6170702e7473780a20202020202b2b2b2b205f646f63756d656e742e7473780a20202020202b2b2b2b20696e6465782e7473780a20202020202b2b207374796c65730a20202020202b2b207075626c69630a20202020202b2b0a0a202020207d0a7d0a0a40656e6473616c74"></figure>
<p>Modules will</p>
<ul>
<li>.next</li>
<li>package.json</li>
<li>package-lock.json</li>
<li>node_modules</li>
<li>src
<ul>
<li>components
<ul>
<li>MyCustomButton</li>
</ul></li>
<li>pages
<ul>
<li>[shipID] :: folder =&gt; represents a route
<ul>
<li>index.tsx =&gt; https://mywebsite.com/[shipID]</li>
<li>[modelID].tsx =&gt; https://mywebsite.com/[shipID]/[modelID]</li>
</ul></li>
<li>landingpage.tsx =&gt; https://mywebsite.com/landingpage.html</li>
<li>index.tsx</li>
<li>_app.tsx :: layout_template</li>
<li>_document.tsx :: custom layout_template</li>
<li>api :: folder &lt;IGNORE, it’s for backend&gt;</li>
</ul></li>
</ul></li>
<li>styles</li>
<li>theme.tsx</li>
</ul>
</section>
<section id="how-do-you-select-ssg-pwa-ssr" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> How do you select SSG, PWA, SSR</h1>
<ul>
<li>Using react hooks means it “may” rerender thus behaving like a PWA</li>
<li>Using getStaticProp() and never using hooks gives you a static site</li>
</ul>
<p>Notice how the lines are actually blurred. You can mix and match so the site behaves like an PWA or a static site.</p>
</section>
<section id="capturing-the-carid-and-modelid-as-variables" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Capturing the [carID] and [modelID] as variables</h1>
<div class="sourceCode" id="cb6"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { useRouter } <span class="im">from</span> <span class="st">'next/router'</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> <span class="kw">function</span> <span class="fu">Home</span>() {</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> router <span class="op">=</span> <span class="fu">useRouter</span>()<span class="op">;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> {myrouteINPUT} <span class="op">=</span> router<span class="op">.</span><span class="at">query</span><span class="op">;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(<span class="op">&lt;</span>div<span class="op">&gt;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;</span>h1<span class="op">&gt;</span>hi the text <span class="kw">in</span> the url parameter is {myrouteINPUT}</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;/</span>h1<span class="op">&gt;</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;/</span>div<span class="op">&gt;</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</section>
<section id="serverside-render" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> ServerSide Render</h1>
<ol type="1">
<li>getStaticPath prerenders dynamic routes, basically you tell [car].js to use <code>{toyota, hyundai}</code> then we prebuild <code>toyota.html hyundai.html</code></li>
<li>getStaticProps fetches data <strong>on build</strong> when <code>next build</code> is called. It only runs on server-side.<br />
The client or window will never see any network call.<br />
This is NOT like <code>window.addEventlistener('onload',..)</code> that fetches data on each client request.</li>
</ol>
<section id="types-of-ssg" class="level2" data-number="6.1">
<h2 data-number="6.1"><span class="header-section-number">6.1</span> 2 types of SSG</h2>
<table>
<thead>
<tr class="header">
<th>getStaticProps()</th>
<th>getStaticPaths()</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>calls on build</td>
<td>calls on first request</td>
</tr>
</tbody>
</table>
</section>
<section id="why-ssg-can-be-bad" class="level2" data-number="6.2">
<h2 data-number="6.2"><span class="header-section-number">6.2</span> Why SSG can be bad?</h2>
<p>SSG at build time and SSG at first request both are affected by stale data.</p>
<ul>
<li>If db changes once, SSG at build time is already stale</li>
<li>If db changes more than once, SSG at first request becomes stale This means if more than one update in db we have to rebuild the ENTIRE site.</li>
</ul>
<hr />
</section>
<section id="solution-to-stale-ssg---isr" class="level2" data-number="6.3">
<h2 data-number="6.3"><span class="header-section-number">6.3</span> Solution to Stale SSG - ISR</h2>
<ul>
<li>Solution ISR which basically means the specific static page ONLY will be rebuilt,</li>
<li>If your clientside code auto refreshes every 10 sec, the data will be relatively current.</li>
</ul>
</section>
</section>
<section id="self-is-not-defined" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Self is Not Defined</h1>
<ul>
<li>When importing react Pixi</li>
</ul>
<p>Reason for error: Pixi library uses ‘self’ or ‘window’ which is only defined in the client side. NextJS does prerendering always on the serverside meaning it will run Pixi on the serverside where there is no ‘self’ or ‘window’.</p>
<p>Fix:</p>
<ol type="1">
<li><p>Use <code>import dynamic from 'next/dynamic';</code></p></li>
<li><p>Use useEffect because it only runs on client side</p></li>
</ol>
</section>
<section id="exporting-as-static-site" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Exporting as static site</h1>
<p>modify package.json for <code>"export": "next export"</code></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> run build</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> run export</span></code></pre></div>
<p>build will create an <code>.next</code> file that is only useful for servers<br />
export will create an <code>out</code> file containing static files like <code>index.html</code><br />
All we need are the <code>out</code> files</p>
<p>Errors:</p>
<ol type="1">
<li>imageOptimisation only works with a server which we dont have. Fis with the experimental turn off image optimization option.</li>
<li>Paths are by default <strong>relative</strong>. Nextjs believes <code>http://server.opnroot.com:5500/</code> is our root. We need to modify our paths with assetPrefix and basePath so it points to <code>http://server.opnroot.com:5500/test1/out</code> as root.
<ul>
<li>apparently assetPrefix is js files and css files while basePath is for images and route links</li>
</ul></li>
</ol>
<div class="sourceCode" id="cb8" data-filename="next.config.js"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">/** </span><span class="an">@type</span><span class="co"> {import('next').NextConfig} */</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> isProd <span class="op">=</span> <span class="kw">false</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> nextConfig <span class="op">=</span> {</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">reactStrictMode</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">swcMinify</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">assetPrefix</span><span class="op">:</span> isProd <span class="op">?</span> <span class="st">'https://cdn.productionsite.com'</span> <span class="op">:</span> <span class="st">'/test1/out'</span><span class="op">,</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">basePath</span><span class="op">:</span> isProd <span class="op">?</span> <span class="st">'https://cdn.productionsite.com'</span> <span class="op">:</span> <span class="st">'/test1/out'</span><span class="op">,</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">experimental</span><span class="op">:</span> {</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">images</span><span class="op">:</span> {</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">unoptimized</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span>  </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>module<span class="op">.</span><span class="at">exports</span> <span class="op">=</span> nextConfig</span></code></pre></div>
<ul>
<li>Cool thing about nextjs is that it generates html when possible unlike react where html is just the entry-point for js.<br />
</li>
<li>Dynamic routes don’t really work.
<ul>
<li>We require <code>getStaticPaths()</code> to pregenerate the route.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb9" data-filename="pages/[car].js"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> Head <span class="im">from</span> <span class="st">'next/head'</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { useRouter } <span class="im">from</span> <span class="st">'next/router'</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> <span class="kw">function</span> <span class="fu">Home</span>(props) {</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> {BLEHdata} <span class="op">=</span> props <span class="co">// This is data loaded from getStaticProps</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(BLEHdata)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> router <span class="op">=</span> <span class="fu">useRouter</span>()<span class="op">;</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> {myrouteINPUT} <span class="op">=</span> router<span class="op">.</span><span class="at">query</span><span class="op">;</span> </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">//</span><span class="al">NOTICE</span><span class="co"> `myrouteINPUT` is undefined, </span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">//since exported static site cant capture dynamic routes</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(<span class="op">&lt;</span>div<span class="op">&gt;</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;</span>h1<span class="op">&gt;</span>hi</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>         {myrouteINPUT}</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;/</span>h1<span class="op">&gt;</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;/</span>div<span class="op">&gt;</span>)</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co">//this pregenerates the &quot;dynamic route&quot; for [car].js</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="co">//REQUIRED FOR ANY DYNAMIC ROUTE that gets exported as static site.</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co">//clearly this isnt really that dynamic since we have to hardcode this.</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">getStaticPaths</span>(){</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>{</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>        <span class="dt">paths</span><span class="op">:</span> [{ <span class="dt">params</span> <span class="op">:</span> {<span class="dt">car</span><span class="op">:</span> <span class="st">&quot;1&quot;</span>}}]<span class="op">,</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fallback</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="co">//This is NOT like just calling window.addEventlistener(&quot;onload&quot;,...)</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="co">//This runs on build time, meaning the browser will NEVER see the GET request to the json server.</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">getStaticProps</span>(){</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> response <span class="op">=</span><span class="cf">await</span> <span class="fu">fetch</span>(<span class="st">&quot;http://jsonplaceholder.typicode.com/users&quot;</span>)</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> BLEHdata <span class="op">=</span> <span class="cf">await</span> response<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(BLEHdata) <span class="co">//this will not output on browser but in terminal</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>{</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>        <span class="dt">props</span><span class="op">:</span> {BLEHdata}</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</section>

        </div>
        <div id="footer">
            <div class="flex-container" style="display:flex; justify-content: space-between;">
                <div>
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
                </div>
   
            <div xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/"><a property="dct:title" rel="cc:attributionURL" href="https://userjy.github.io/">Jason's Notes</a> by <a rel="cc:attributionURL dct:creator" property="cc:attributionName" href="https://userjy.github.io/">Jason Yang</a> is licensed under <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">CC BY-NC-ND 4.0<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/nc.svg?ref=chooser-v1"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/nd.svg?ref=chooser-v1"></a></div>
  
            </div>
        </div>
        
    </body>
    <footer>
        <!-- CODE TAB START -->
        <script>
                    //Structure:
                    // Codeblock < Group/Grouplabel/subgrp < datagroupSet < allblocks

            const AllBlocksPre = document.querySelectorAll("[data-group]");
            const AllBlocks = [...AllBlocksPre]; //gets all codeblocks w/ and w/o group label
            const getUniqueSet = (TargetSet,dataAttr) => {
                //gets the set of attributes of an array of codeblocks aka TargetSet
                const temp = TargetSet.map((e) => (e.getAttribute(dataAttr))); 
                const temp2 = temp.filter((a)=>a); //remove nulls
                return [...new Set(temp2)];
            } 
            const datagroupSet = getUniqueSet(AllBlocks,"data-group") //remove nulls

            const getCodeBlocks = (datagroup) => {
                //return list of glabels CodeBlocks associated to a single group 
                return AllBlocks.filter((dataglabelBlock)=>(dataglabelBlock.getAttribute("data-group") === datagroup));
            }

            const showBlocks = (dataglabeltxt,datagroupCodeBlocks) => {
                const selectedglabelGroup = datagroupCodeBlocks.filter((SingleBlock)=>(SingleBlock.getAttribute("data-glabel") === dataglabeltxt))
                const NONselectedglabelGroup = datagroupCodeBlocks.filter((SingleBlock)=>(SingleBlock.getAttribute("data-glabel") !== dataglabeltxt))
                selectedglabelGroup.map((SingleBlock) => (SingleBlock.style.display="block"));
                (NONselectedglabelGroup || []).map((SingleBlock) => (SingleBlock.style.display="none"));
            }
            const mkBtn = (dataglabeltxt,datagroupCodeBlocks,showfunc) => {
                const newbutton = document.createElement("button");
                newbutton.textContent = dataglabeltxt;
                newbutton.addEventListener('click', ()=>{
                    showfunc(dataglabeltxt,datagroupCodeBlocks);
                });
                return newbutton;
            }
            const showAll = (datagroup) => {
                //make all codeblocks visible
            datagroup.map((e)=>(e.style.display="block"));
            }

            const buildCodeTab = (datagroupCodeBlocks) => {
                const leader = datagroupCodeBlocks[0]; //get the leader codeblock of a group of codeblock
                const setglabelstxt = getUniqueSet(datagroupCodeBlocks,"data-glabel"); 
                setglabelstxt.map((singleglabeltxt)=>{
                    const btn = mkBtn(singleglabeltxt,datagroupCodeBlocks,showBlocks)
                    leader.insertAdjacentElement("beforebegin",btn);

                })
                
                //make showAll button START
                const btnShowAll = document.createElement("button");
                btnShowAll.textContent = "All";
                btnShowAll.addEventListener('click',(e)=>(showAll(datagroupCodeBlocks)));
                leader.insertAdjacentElement('beforebegin', btnShowAll);
                //make showAllbutton END
            }

            //below code is performing actual behavior, the above code are just functions
            datagroupSet.map((datagroup) => {
                const groupOfCodeblocks = getCodeBlocks(datagroup);
                buildCodeTab(groupOfCodeblocks);
                const firsttab = groupOfCodeblocks[0]
                showBlocks(firsttab.getAttribute("data-glabel"),groupOfCodeblocks);
       
            })
        </script>
        <!-- CODE TAB END ---->

        <!-- MATH JAX START -------------------------------------- -->
        <script id="MathJax-script" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-chtml.min.js">
        </script>
        <!-- MATH JAX END ----------------------------------------- -->

        <!-- RAILROAD START -------------------------------------- -->
        <script type="module">
            import rr,* as rrClass from "/lib/railroad/railroad.js";
            Object.assign(window,rr)
            window.rrOptions = rrClass.Options;
            document.addEventListener('DOMContentLoaded',()=>{ReplaceDivWithSvg()},false)
            const ReplaceDivWithSvg = () =>  {
                for (const railroadelem of document.getElementsByClassName("rroad") ){
                railroadelem.innerHTML = eval(railroadelem.innerText.trim()+".toString()")
                }
            }
        </script>
        

        <link rel="stylesheet" href="../lib/railroad/railroad-diagrams.css">
        <!-- RAILROAD END ----------------------------------------- -->
    </footer>
</html>
